import React, {
  useState,
  useEffect,
  useMemo,
  useCallback,
  useRef,
} from 'react';
import {
  Settings,
  Download,
  Trash2,
  Plus,
  Sun,
  Moon,
  CreditCard,
} from 'lucide-react';

// NOTE: In a real-world React project, you would install these via npm (npm install jspdf html2canvas).
// For this single-file environment, we assume they are loaded via external scripts in the HTML wrapper.
// The functions are accessed globally: new jsPDF.jsPDF() and window.html2canvas()

/**
 * Utility function to format currency
 * @param {number} amount
 * @returns {string}
 */
const formatCurrency = (amount) => {
  return (amount || 0).toLocaleString('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });
};

// Initial state for the invoice data
const initialInvoiceData = {
  invoiceNumber: 'INV-2024-001',
  date: new Date().toISOString().substring(0, 10),
  dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
    .toISOString()
    .substring(0, 10), // 30 days later
  senderName: 'Frontend Pro Solutions',
  senderAddress: '101 React Way, Dev City',
  senderEmail: 'billing@prosolutions.com',
  senderPhone: '+1 555-DEV-PROJ',
  clientName: 'Innovate Global Inc.',
  clientAddress: '200 Design Blvd, Tech Hub',
  clientEmail: 'accounts@innovateglobal.com',
  clientPhone: '+1 555-BUS-ACC',
  items: [
    {
      id: 1,
      description: 'UX/UI Wireframing (Hours)',
      quantity: 20,
      price: 75.0,
    },
    {
      id: 2,
      description: 'React Component Development',
      quantity: 80,
      price: 95.0,
    },
  ],
  taxRate: 7.5, // Percentage
  discount: 0, // Fixed amount discount
  notes:
    'Thank you for choosing Frontend Pro Solutions. Your timely payment is appreciated.',
};

const Header = ({ darkMode, toggleDarkMode }) => {
  const textColor = darkMode ? 'text-gray-100' : 'text-gray-900';
  const iconColor = darkMode ? 'text-indigo-400' : 'text-indigo-600';

  return (
    <header className='flex justify-between items-center p-4 border-b border-gray-700/10'>
      <h1 className={`text-2xl font-extrabold ${textColor} flex items-center`}>
        <CreditCard className={`w-6 h-6 mr-3 ${iconColor}`} />
        Invoice Generator
      </h1>
      <div className='flex items-center space-x-4'>
        <button
          onClick={toggleDarkMode}
          className={`p-2 rounded-full transition-all duration-300 ${
            darkMode
              ? 'bg-gray-700 hover:bg-gray-600 text-yellow-300'
              : 'bg-gray-100 hover:bg-gray-200 text-gray-800'
          }`}
          aria-label='Toggle Dark Mode'
        >
          {darkMode ? (
            <Sun className='w-5 h-5' />
          ) : (
            <Moon className='w-5 h-5' />
          )}
        </button>
        <button
          className='p-2 bg-indigo-500 text-white rounded-full hover:bg-indigo-600 transition duration-150 shadow-md'
          aria-label='Settings'
        >
          <Settings className='w-5 h-5' />
        </button>
      </div>
    </header>
  );
};
// ItemList Component
const ItemList = ({ items, updateItem, addItem, removeItem, darkMode }) => {
  const inputStyle = `w-full bg-transparent border-b ${darkMode ? 'border-gray-600 text-gray-200' : 'border-gray-300 text-gray-900'} focus:border-indigo-500 outline-none p-1 transition-colors`;
  const headerStyle = `px-4 py-2 text-left font-semibold ${darkMode ? 'text-indigo-300 bg-gray-700' : 'text-indigo-700 bg-indigo-50'}`;
  const rowStyle = `${darkMode ? 'border-gray-700 hover:bg-gray-800' : 'border-gray-200 hover:bg-gray-50'}`;

    return (
    <div className="mt-8 overflow-x-auto">
      <table className="min-w-full border-collapse border-spacing-0">
        <thead>
          <tr>
            <th className={`${headerStyle} w-1/2 rounded-tl-lg`}>Description</th>
            <th className={`${headerStyle} w-1/6 text-right`}>Qty</th>
            <th className={`${headerStyle} w-1/6 text-right`}>Price</th>
            <th className={`${headerStyle} w-1/6 text-right`}>Amount</th>
            <th className={`${headerStyle} w-10 rounded-tr-lg`}></th>
          </tr>
        </thead>
        <tbody>
          {items.map((item, index) => {
            const amount = item.quantity * item.price;
            return (
              <tr key={item.id} className={rowStyle}>
                <td className="p-2 border-b">
                  <input
                    type="text"
                    value={item.description}
                    onChange={(e) => updateItem(item.id, 'description', e.target.value)}
                    placeholder="Item description"
                    className={inputStyle}
                  />
                </td>
                <td className="p-2 border-b">
                  <input
                    type="number"
                    value={item.quantity}
                    onChange={(e) => updateItem(item.id, 'quantity', parseFloat(e.target.value))}
                    min="0"
                    placeholder="0"
                    className={`${inputStyle} text-right`}
                  />
                </td>